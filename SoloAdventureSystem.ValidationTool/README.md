# LLamaSharp Validation Tool

## Purpose

Quick and easy way to validate that LLamaSharp is working properly on your system.

## What It Tests

1. ? **Model File Check** - Verifies model file exists and size
2. ? **Model Download/Verify** - Downloads if missing, verifies if present
3. ? **Adapter Initialization** - Loads model into memory
4. ? **Text Generation** - Generates sample text to verify inference works

## Usage

### Test Default Model (Phi-3-mini Q4 - 2GB)
```bash
cd SoloAdventureSystem.ValidationTool
dotnet run
```

### Test Specific Model
```bash
# TinyLlama (600MB - faster, less RAM)
dotnet run -- tinyllama-q4

# Llama 3.2 1B (800MB)
dotnet run -- llama-3.2-1b-q4

# Phi-3-mini (2GB - default)
dotnet run -- phi-3-mini-q4
```

## Expected Output

### Success
```
???????????????????????????????????????????????????????????
  LLamaSharp Validation Tool
???????????????????????????????????????????????????????????

Testing model: phi-3-mini-q4

???????????????????????????????????????????????????????????
? Step 1: Checking Model File                            ?
???????????????????????????????????????????????????????????
Model path: C:\Users\...\SoloAdventureSystem\models\phi-3-mini-q4.gguf
? File exists: 2.0 GB
   Last modified: 2024-01-15 10:30:00

???????????????????????????????????????????????????????????
? Step 2: Downloading/Verifying Model                    ?
???????????????????????????????????????????????????????????
? Model ready in 0.2s

???????????????????????????????????????????????????????????
? Step 3: Initializing LLamaSharp Adapter                ?
???????????????????????????????????????????????????????????
? Adapter initialized in 8.3s

???????????????????????????????????????????????????????????
? Step 4: Testing Text Generation                        ?
???????????????????????????????????????????????????????????
Prompt: "Describe a cyberpunk room in 2 sentences."

Generated text:
???????????????????????????????????????????????????????????
The dimly lit room is filled with the hum of servers and
flickering neon lights casting an eerie glow. Holographic
displays dance across the walls, showing encrypted data.
???????????????????????????????????????????????????????????
? Generated in 3.2s

???????????????????????????????????????????????????????????
  ? ALL TESTS PASSED - LLamaSharp is working correctly!
???????????????????????????????????????????????????????????

Summary:
  Model: phi-3-mini-q4
  Download/Verify: 0.2s
  Initialization: 8.3s
  Text Generation: 3.2s
  Total Time: 11.7s
```

### First Run (With Download)
```
???????????????????????????????????????????????????????????
? Step 2: Downloading/Verifying Model                    ?
???????????????????????????????????????????????????????????
   Progress: 10% - 4m 30s remaining
   Progress: 20% - 3m 45s remaining
   Progress: 30% - 3m 10s remaining
   ...
   Progress: 100% - 0s remaining
? Model ready in 245.3s
```

## Troubleshooting

### Error: "Failed to load model"
**Cause**: Corrupted model file  
**Solution**: Delete and re-download
```powershell
# Delete corrupted model
Remove-Item "$env:APPDATA\SoloAdventureSystem\models\phi-3-mini-q4.gguf"

# Run validator again to re-download
dotnet run
```

### Error: "Out of memory"
**Cause**: Insufficient RAM  
**Solution**: Try smaller model
```bash
dotnet run -- tinyllama-q4
```

### Error: "Could not acquire mutex"
**Cause**: Another process is using the model  
**Solution**: Wait or kill other processes
```powershell
# Check for running processes
Get-Process | Where-Object {$_.ProcessName -like "*worldgen*" -or $_.ProcessName -like "*SoloAdventure*"}
```

## Integration with Tests

Use this tool before running integration tests to ensure LLamaSharp is working:

```bash
# 1. Validate LLamaSharp is working
cd SoloAdventureSystem.ValidationTool
dotnet run

# 2. If validation passes, run tests
cd ..
dotnet test
```

## CI/CD Integration

Add to your build pipeline:

```yaml
- name: Validate LLamaSharp
  run: |
    cd SoloAdventureSystem.ValidationTool
    dotnet run
  timeout-minutes: 15

- name: Run Tests
  if: success()
  run: dotnet test
```

## What This Tool Does NOT Test

- ? Quality of generated content (just verifies it generates something)
- ? Full world generation (use integration tests for that)
- ? Export and ZIP functionality
- ? Validation logic

For comprehensive testing, use the integration test suite:
```bash
dotnet test SoloAdventureSystem.CLI.Tests
```

## Quick Reference

| Command | Purpose |
|---------|---------|
| `dotnet run` | Test default model (Phi-3) |
| `dotnet run -- tinyllama-q4` | Test smaller model |
| `dotnet run -- llama-3.2-1b-q4` | Test Llama 3.2 |
| Clean models: `Remove-Item -Recurse "$env:APPDATA\SoloAdventureSystem\models\"` |

## Exit Codes

- `0` - All tests passed ?
- `1` - Validation failed ?

Use in scripts:
```bash
if dotnet run; then
    echo "LLamaSharp is working!"
    dotnet test
else
    echo "LLamaSharp validation failed!"
    exit 1
fi
```
