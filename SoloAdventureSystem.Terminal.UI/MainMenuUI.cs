using Terminal.Gui;
using SoloAdventureSystem.UI.Themes;

namespace SoloAdventureSystem.UI;

/// <summary>
/// Main menu UI for the Solo Adventure System
/// </summary>
public class MainMenuUI
{
    public enum MenuChoice
    {
        None,
        GenerateWorld,
        PlayWorld,
        Settings,
        Exit
    }

    public Action<MenuChoice>? OnMenuChoice { get; set; }

    public MenuChoice ShowMenu()
    {
        var choice = MenuChoice.None;
        
        var win = CreateWindow();
        
        // Set the callback to capture the choice
        OnMenuChoice = (c) => {
            choice = c;
            Application.RequestStop();
        };
        
        Application.Run(win);
        
        return choice;
    }

    public Window CreateWindow()
    {
        var win = ComponentFactory.CreateWindow("Solo Adventure System");
        win.X = 0;
        win.Y = 0;
        win.Width = Dim.Fill();
        win.Height = Dim.Fill();

        // Decorative header
        var header = ComponentFactory.CreateTitle(@"
???????????????????????????????????????????????????????????????????????????????????
?                                                                                   ?
?   ???????  ??????  ??       ??????       ?????  ??????  ??   ?? ???????  ???    ?? ???????? ??    ?? ??????  ???????   ?
?   ??      ??    ?? ??      ??    ??     ??   ?? ??   ?? ??   ?? ??       ????   ??    ??    ??    ?? ??   ?? ??        ?
?   ??????? ??    ?? ??      ??    ??     ??????? ??   ?? ??   ?? ?????    ?? ??  ??    ??    ??    ?? ??????  ?????     ?
?        ?? ??    ?? ??      ??    ??     ??   ?? ??   ??  ?? ??  ??       ??  ?? ??    ??    ??    ?? ??   ?? ??        ?
?   ???????  ??????  ???????  ??????      ??   ?? ??????    ???   ???????  ??   ????    ??     ??????  ??   ?? ???????   ?
?   ???????  ??    ?? ??????? ???????     ??   ?? ???????   ??    ???????  ??    ???    ??     ??????? ??   ?? ???????   ?
?                                                                                   ?
???????????????????????????????????????????????????????????????????????????????????");
        header.X = Pos.Center();
        header.Y = 1;
        header.Height = 10;

        // Tagline with icons
        var subtitle = ComponentFactory.CreateAccentLabel("Your Story Awaits - Infinite Worlds - Epic Quests");
        subtitle.X = Pos.Center();
        subtitle.Y = 11;
        subtitle.TextAlignment = TextAlignment.Centered;

        // Description
        var description = ComponentFactory.CreateMutedLabel("A solo tabletop RPG experience powered by AI");
        description.X = Pos.Center();
        description.Y = 12;
        description.TextAlignment = TextAlignment.Centered;

        // Menu frame with better styling
        var menuFrame = ComponentFactory.CreateFrame("? Main Menu ?");
        menuFrame.X = Pos.Center();
        menuFrame.Y = 14;
        menuFrame.Width = 60;
        menuFrame.Height = 10;

        // Menu buttons with descriptions
        var generateBtn = ComponentFactory.CreatePrimaryButton("[ + ] Generate New World");
        generateBtn.X = Pos.Center();
        generateBtn.Y = 1;
        generateBtn.Clicked += () =>
        {
            OnMenuChoice?.Invoke(MenuChoice.GenerateWorld);
        };

        var generateDesc = ComponentFactory.CreateMutedLabel("Create a new AI-generated adventure world");
        generateDesc.X = Pos.Center();
        generateDesc.Y = 2;
        generateDesc.TextAlignment = TextAlignment.Centered;

        var playBtn = ComponentFactory.CreatePrimaryButton("[ > ] Play Adventure");
        playBtn.X = Pos.Center();
        playBtn.Y = 4;
        playBtn.Clicked += () =>
        {
            OnMenuChoice?.Invoke(MenuChoice.PlayWorld);
        };

        var playDesc = ComponentFactory.CreateMutedLabel("Explore an existing world and embark on quests");
        playDesc.X = Pos.Center();
        playDesc.Y = 5;
        playDesc.TextAlignment = TextAlignment.Centered;

        var exitBtn = ComponentFactory.CreateDangerButton("[ X ] Exit");
        exitBtn.X = Pos.Center();
        exitBtn.Y = 7;
        exitBtn.Clicked += () =>
        {
            OnMenuChoice?.Invoke(MenuChoice.Exit);
        };

        menuFrame.Add(generateBtn, generateDesc, playBtn, playDesc, exitBtn);

        // Footer with better instructions
        var footer = ComponentFactory.CreateHintLabel("Up/Down Navigate - Enter Select - Ctrl+C Quit");
        footer.X = Pos.Center();
        footer.Y = Pos.AnchorEnd(1);

        win.Add(header, subtitle, description, menuFrame, footer);

        return win;
    }
}
