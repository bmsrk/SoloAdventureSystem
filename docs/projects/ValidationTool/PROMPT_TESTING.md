# LLamaSharp Prompt Testing Tools

## Overview

Two complementary tools for testing if LLamaSharp is answering prompts correctly:

1. **Validation Tool** (`Program.cs`) - Automated validation with multiple prompt types
2. **Interactive Tester** (`InteractivePromptTester.cs`) - Interactive prompt testing
3. **Prompt Tester Library** (`PromptTester.cs`) - Reusable testing wrapper

## Tools

### 1. Validation Tool (Automated)

**Purpose**: Automated testing of multiple prompt types with quality validation

**Usage**:
```bash
cd SoloAdventureSystem.ValidationTool
dotnet run
```

**What it tests**:
- ? Room descriptions
- ? NPC biographies
- ? Faction descriptions
- ? Response quality (length, non-empty)

**Output**:
```
???????????????????????????????????????????????????????????
  LLamaSharp Validation Tool
???????????????????????????????????????????????????????????

Testing model: phi-3-mini-q4

???????????????????????????????????????????????????????????
? Step 1: Checking Model File                            ?
???????????????????????????????????????????????????????????
? File exists: 2.0 GB

???????????????????????????????????????????????????????????
? Step 2: Downloading/Verifying Model                    ?
???????????????????????????????????????????????????????????
? Model ready in 0.2s

???????????????????????????????????????????????????????????
? Step 3: Initializing LLamaSharp Adapter                ?
???????????????????????????????????????????????????????????
? Adapter initialized in 8.3s

???????????????????????????????????????????????????????????
? Step 4: Testing Text Generation                        ?
???????????????????????????????????????????????????????????
Test 1: Room Description
Prompt: "Describe a cyberpunk room in 2 sentences."

Generated text:
???????????????????????????????????????????????????????????
The dimly lit room is filled with the hum of servers...
???????????????????????????????????????????????????????????
? Generated in 3.2s
? Response quality: 156 characters

Test 2: NPC Biography
Prompt: "Create a short bio for a cyberpunk hacker named Raven."

Generated text:
???????????????????????????????????????????????????????????
Raven is a skilled netrunner who operates from the shadows...
???????????????????????????????????????????????????????????
? Generated in 2.8s
? Response quality: 142 characters

Test 3: Faction Description
Prompt: "Describe a cyberpunk faction called 'The Neon Syndicate'."

Generated text:
???????????????????????????????????????????????????????????
The Neon Syndicate controls the underground markets...
???????????????????????????????????????????????????????????
? Generated in 3.1s
? Response quality: 178 characters

???????????????????????????????????????????????????????????
  ? ALL TESTS PASSED - LLamaSharp is working correctly!
???????????????????????????????????????????????????????????

Summary:
  Model: phi-3-mini-q4
  Download/Verify: 0.2s
  Initialization: 8.3s
  Text Generation:
    - Room Description: 3.2s (156 chars)
    - NPC Biography: 2.8s (142 chars)
    - Faction Description: 3.1s (178 chars)
  Total Generation Time: 9.1s
  Overall Total: 17.6s

? All 3 generation types working correctly!
```

### 2. Interactive Prompt Tester

**Purpose**: Test custom prompts interactively

**Usage**:
```bash
cd SoloAdventureSystem.ValidationTool
dotnet run --project InteractivePromptTester.cs
```

Or compile and run:
```bash
# Add to csproj as additional entry point or
# Change Main method temporarily
```

**Features**:
- Quick validation mode
- Custom prompt testing
- Choose prompt type (Room/NPC/Faction)
- Specify seed for reproducibility
- Interactive loop

**Example session**:
```
???????????????????????????????????????????????????????????
  Interactive LLamaSharp Prompt Tester
???????????????????????????????????????????????????????????

Quick way to test if LLamaSharp is answering prompts.

Using model: phi-3-mini-q4

? Initializing LLamaSharp adapter...
? Adapter initialized successfully

Commands:
  1. Quick validation (test all types)
  2. Test custom prompt
  3. Exit

> 1

???????????????????????????????????????????????????????????
? Quick Validation Test                                   ?
???????????????????????????????????????????????????????????

Type: RoomDescription
Prompt: "Describe a cyberpunk room with neon lights."
Seed: 42
? Success in 3.1s (145 chars)
Response:
???????????????????????????????????????????????????????????
The room pulses with blue and pink neon, casting eerie...
???????????????????????????????????????????????????????????

[... more results ...]

? All quick validation tests passed!

> 2

Enter prompt type (1=Room, 2=NPC, 3=Faction):
> 1

Enter your prompt:
> Describe a high-tech laboratory with holographic displays

Enter seed (or press Enter for random):
> 999

? Generating...

Type: RoomDescription
Prompt: "Describe a high-tech laboratory with holographic displays"
Seed: 999
? Success in 3.4s (167 chars)
Response:
???????????????????????????????????????????????????????????
Holographic displays float throughout the lab, showing...
???????????????????????????????????????????????????????????

> 3

Goodbye! ??
```

### 3. Prompt Tester Library

**Purpose**: Programmatic testing in your own code

**Usage**:
```csharp
using SoloAdventureSystem.Tools;

// Create tester
using var tester = new PromptTester("phi-3-mini-q4");

// Initialize
if (await tester.InitializeAsync())
{
    // Test single prompt
    var result = tester.TestPrompt(
        "Describe a cyberpunk bar",
        seed: 42,
        type: PromptType.RoomDescription
    );
    
    result.PrintResult();
    
    // Or quick validation
    bool allPassed = tester.QuickValidation();
}
```

**Methods**:
- `InitializeAsync()` - Download/load model
- `TestPrompt()` - Test single prompt
- `TestPrompts()` - Test multiple prompts
- `QuickValidation()` - Run standard validation tests

## LLamaSharp Unit Tests

**Location**: `SoloAdventureSystem.Engine.Tests\LLamaSharpAdapterTests.cs`

**Tests**:
1. `GenerateRoomDescription_WithValidPrompt_ReturnsNonEmptyText` - Room description generation
2. `GenerateNpcBio_WithValidPrompt_ReturnsNonEmptyText` - NPC bio generation
3. `GenerateFactionFlavor_WithValidPrompt_ReturnsNonEmptyText` - Faction description
4. `GenerateLoreEntries_WithValidPrompt_ReturnsCorrectCount` - Multiple lore entries
5. `GenerateRoomDescription_SameSeed_ProducesSameOutput` - Determinism test
6. `GenerateRoomDescription_DifferentSeeds_ProducesDifferentOutput` - Variance test
7. `GenerateRoomDescription_MultipleTypes_AllSucceed` - Multiple types test

**Run tests**:
```bash
# All LLamaSharp tests (skipped by default - long running)
dotnet test --filter "FullyQualifiedName~LLamaSharpAdapterTests"

# Specific test
dotnet test --filter "FullyQualifiedName~GenerateRoomDescription_WithValidPrompt"
```

**Note**: All tests are skipped by default because they:
- Require model download (~2GB)
- Take 1-5 minutes to run
- Run manually when needed

**Enable tests**:
Remove `Skip = "..."` from test attributes or run explicitly:
```bash
dotnet test --filter "FullyQualifiedName~LLamaSharpAdapter"
```

## Quick Reference

| Tool | Use Case | Duration | Interactive |
|------|----------|----------|-------------|
| Validation Tool | Automated validation | ~15s | No |
| Interactive Tester | Custom prompts | Varies | Yes |
| Unit Tests | CI/CD, regression | 2-5 min | No |
| Prompt Tester Library | Programmatic | Varies | No |

## Common Workflows

### Before Running Tests
```bash
# Validate LLamaSharp works
cd SoloAdventureSystem.ValidationTool
dotnet run
```

### Test Custom Prompt
```bash
# Use interactive tester
cd SoloAdventureSystem.ValidationTool
# Run InteractivePromptTester
```

### Run Full Test Suite
```bash
# Enable LLamaSharp tests
dotnet test --filter "FullyQualifiedName~LLamaSharpAdapter"
```

### Quick Quality Check
```bash
# Use validation tool
cd SoloAdventureSystem.ValidationTool
dotnet run

# Look for:
# ? All 3 generation types working correctly!
```

## Troubleshooting

### No output / Empty responses
```bash
# Check model file
ls "$env:APPDATA\SoloAdventureSystem\models\"

# Delete and re-download
Remove-Item "$env:APPDATA\SoloAdventureSystem\models\*" -Force
dotnet run
```

### Generation takes too long
```bash
# Try smaller model
dotnet run -- tinyllama-q4
```

### Responses don't make sense
```bash
# Check:
# 1. Model is fully downloaded (not corrupted)
# 2. Using appropriate prompt templates
# 3. Context size is sufficient (2048+)
```

## Exit Codes

- `0` - All tests passed ?
- `1` - Validation failed ?

Use in scripts:
```bash
if dotnet run; then
    echo "? LLamaSharp is working!"
    dotnet test
else
    echo "? LLamaSharp validation failed"
    exit 1
fi
```

## Integration Examples

### Pre-commit Hook
```bash
#!/bin/bash
cd SoloAdventureSystem.ValidationTool
if dotnet run; then
    echo "? LLamaSharp validation passed"
    exit 0
else
    echo "? LLamaSharp validation failed - fix before committing"
    exit 1
fi
```

### CI/CD Pipeline
```yaml
- name: Validate LLamaSharp
  run: |
    cd SoloAdventureSystem.ValidationTool
    dotnet run
  timeout-minutes: 15

- name: Run LLamaSharp Tests
  if: success()
  run: dotnet test --filter "FullyQualifiedName~LLamaSharpAdapter"
  timeout-minutes: 10
```

## Summary

**3 Ways to Test LLamaSharp Prompts**:
1. ? Automated Validation Tool - Quick, multiple types
2. ? Interactive Tester - Custom prompts, exploratory testing
3. ? Unit Tests - CI/CD, regression testing

**All tools validate**:
- Model loading works
- Text generation produces output
- Responses are non-empty and reasonable length
- Different prompt types all work

**Choose based on your needs**:
- Quick check? ? Validation Tool
- Try custom prompts? ? Interactive Tester  
- CI/CD? ? Unit Tests
- Programmatic? ? PromptTester Library
